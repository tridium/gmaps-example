define("hbs!nmodule/gmaps/rc/GMapsWidgetTemplate",["Handlebars"],function(k){var e=k.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(g,a,d,e,f){var b;return'\x3c!DOCTYPE html\x3e\n\x3chtml\x3e\n\x3chead\x3e\n  \x3cmeta name\x3d"viewport" content\x3d"initial-scale\x3d1.0, user-scalable\x3dno"\x3e\n  \x3cmeta charset\x3d"utf-8"\x3e\n  \x3cstyle\x3e\n    html, body, #map-canvas {\n      height: 100%;\n      margin: 0;\n      padding: 0;\n    }\n  \x3c/style\x3e\n  \x3cscript src\x3d"https://maps.googleapis.com/maps/api/js?v\x3d3.exp\x26key\x3d'+
g.escapeExpression((b=null!=(b=d.key||(null!=a?a.key:a))?b:d.helperMissing,"function"===typeof b?b.call(null!=a?a:{},{name:"key",hash:{},data:f}):b))+'"\x3e\x3c/script\x3e\n\x3c/head\x3e\n\x3cbody\x3e\n  \x3cdiv id\x3d"map-canvas"\x3e\x3c/div\x3e\n  \x3cscript\x3e\n    google.maps.event.addDomListener(window, "load", function () {\n      var origin \x3d window.top.location.origin || \n        window.location.protocol + "//" + window.location.hostname + \n        (window.location.port ? ":" + window.location.port: "");\n\n      window.postMessage("googleMapsLoaded", origin);\n    });\n  \x3c/script\x3e\n\x3c/body\x3e\n\x3c/html\x3e\n'},
useData:!0});k.registerPartial("nmodule/gmaps/rc/GMapsWidgetTemplate",e);return e});
define("hbs!nmodule/gmaps/rc/PopupTemplate",["Handlebars"],function(k){var e=k.template({compiler:[7,"\x3e\x3d 4.0.0"],main:function(g,a,d,e,f){var b,c;return"\x3ca target\x3d'new' href\x3d'javascript:window.top.niagara.env.hyperlink(\""+g.escapeExpression((c=null!=(c=d.ord||(null!=a?a.ord:a))?c:d.helperMissing,"function"===typeof c?c.call(null!=a?a:{},{name:"ord",hash:{},data:f}):c))+"\");'\x3e"+g.escapeExpression((c=null!=(c=d.displayName||(null!=a?a.displayName:a))?c:d.helperMissing,"function"===
typeof c?c.call(null!=a?a:{},{name:"displayName",hash:{},data:f}):c))+"\x3c/a\x3e\n\x3cbr /\x3e\n\x3cbr /\x3e\n\x3ctable border\x3d'1'\x3e\n  \x3ctr\x3e\n    \x3cth\x3e"+g.escapeExpression((c=null!=(c=d.name||(null!=a?a.name:a))?c:d.helperMissing,"function"===typeof c?c.call(null!=a?a:{},{name:"name",hash:{},data:f}):c))+"\x3c/th\x3e\n    \x3cth\x3e"+g.escapeExpression((c=null!=(c=d.display||(null!=a?a.display:a))?c:d.helperMissing,"function"===typeof c?c.call(null!=a?a:{},{name:"display",hash:{},
data:f}):c))+"\x3c/th\x3e\n  \x3c/tr\x3e  \n"+(null!=(b=d["if"].call(null!=a?a:{},null!=a?a.rows:a,{name:"if",hash:{},fn:g.program(1,f,0),inverse:g.noop,data:f}))?b:"")+"\x3c/table\x3e\n\x3cbr /\x3e\n\x3cbr /\x3e\n"},1:function(g,a,d,e,f){var b;return null!=(b=d.each.call(null!=a?a:{},null!=a?a.rows:a,{name:"each",hash:{},fn:g.program(2,f,0),inverse:g.noop,data:f}))?b:""},2:function(e,a,d,k,f){var b;return"    \x3ctr\x3e\n      \x3ctd\x3e"+e.escapeExpression((b=null!=(b=d.displayName||(null!=a?a.displayName:
a))?b:d.helperMissing,"function"===typeof b?b.call(null!=a?a:{},{name:"displayName",hash:{},data:f}):b))+"\x3c/td\x3e\n      \x3ctd\x3e"+e.escapeExpression((b=null!=(b=d.value||(null!=a?a.value:a))?b:d.helperMissing,"function"===typeof b?b.call(null!=a?a:{},{name:"value",hash:{},data:f}):b))+"\x3c/td\x3e\n    \x3c/tr\x3e\n"},useData:!0});k.registerPartial("nmodule/gmaps/rc/PopupTemplate",e);return e});
define("nmodule/gmaps/rc/GMapsWidget","baja! baja!baja:IStatus bajaux/Widget bajaux/mixin/subscriberMixIn jquery Promise underscore hbs!nmodule/gmaps/rc/GMapsWidgetTemplate hbs!nmodule/gmaps/rc/PopupTemplate lex!gmaps css!nmodule/gmaps/rc/GMapsWidgetStyle".split(" "),function(k,e,g,a,d,m,f,b,c,s){function p(a){a=a.split(",");return{lat:parseFloat(1<a.length?a[0].trim():0),lng:parseFloat(1<a.length?a[1].trim():0)}}function q(a){return a.getType().is("baja:IStatus")&&(a=k.Status.getStatusFromIStatus(a))&&
a.isAlarm()?t:u}function v(a,b){var h=a.$gmaps,d=a.$map,e=p(b.get(k.ComponentTags.idToSlotName("n:geoCoord"))),f=new h.LatLng(e.lat,e.lng),g=new h.Marker({position:f,map:d,title:b.getDisplayName(),icon:q(b),optimized:!1}),n=new h.InfoWindow,l;a.getSubscriber().attach("changed",function(){this===b&&g.setIcon(q(b))});h.event.addListener(g,"click",function(){d.panTo(f);l=function(){if(this===b){var a={ord:b.getNavOrd().relativizeToSession().toString(),displayName:b.getDisplayName(),name:r.get("name"),
display:r.get("display")};b.getSlots().flags(k.Flags.SUMMARY).each(function(d){a.rows=a.rows||[];a.rows.push({displayName:b.getDisplayName(d),value:b.getDisplay(d)||b.get(d)})});n.setContent(c(a))}};l.call(b);n.open(d,g);a.getSubscriber().attach("changed",l)});h.event.addListener(n,"closeclick",function(){a.getSubscriber().detach("changed",l)})}var u="/module/gmaps/rc/ok.png",t="/module/gmaps/rc/alarm.gif",r=s[0];e=function(){g.apply(this,arguments);this.properties().add("position","37.644298,-77.575986").add("zoom",
14).add("key","");a(this)};e.prototype=new g;e.prototype.constructor=e;e.prototype.doInitialize=function(a){var c,h=this,e;a.addClass("gMapsWidget");c=d("\x3ciframe class\x3d'gMapsWidget' src\x3d'about:blank' /\x3e");a.append(c);e=c.get(0).contentWindow;return(new m(function(a,d){var c=e.document;c.open("text/html","replace");c.write(b({key:h.properties().getValue("key")}));c.close();e.addEventListener("message",function(b){"googleMapsLoaded"===b.data&&a()},!1)})).then(function(){return new m(function(a,
b){d(e).ready(function(){h.$gmaps=e.google.maps;a()})})}).then(function(){var a=e.document.getElementById("map-canvas"),b=p(h.properties().getValue("position")),c=h.properties().getValue("zoom");h.$map=new h.$gmaps.Map(a,{zoom:c,center:{lat:b.lat,lng:b.lng}})})};e.prototype.doLoad=function(a){var b=this;return a.cursor().then(function(a){var b=[];a.each(function(){b.push(this.get())});return b}).then(function(a){return m.all(f.map(a,function(a){return a.tags()}))}).then(function(a){a=f.filter(a,function(a){return a.contains("n:ordInSession")&&
a.contains("n:geoCoord")});a=f.map(a,function(a){return a.get("n:ordInSession")});return(new k.BatchResolve(a)).resolve({subscriber:b.getSubscriber()})}).then(function(a){a=a.getTargetObjects();f.each(a,function(a){v(b,a)})})};e.prototype.doDestroy=function(){this.jq().removeClass("gMapsWidget")};return e});